
import React from 'react';
import GlassCard from '../GlassCard.tsx';

interface TapData {
    lat: number;
    lng: number;
    count: number;
}

interface TapHeatmapProps {
    data: TapData[];
}

// A simplified map projection (Mercator)
const project = (lat: number, lng: number, width: number, height: number) => {
    const x = (lng + 180) * (width / 360);
    const latRad = lat * Math.PI / 180;
    const mercN = Math.log(Math.tan((Math.PI / 4) + (latRad / 2)));
    const y = (height / 2) - (width * mercN / (2 * Math.PI));
    return { x, y };
};

const TapHeatmap: React.FC<TapHeatmapProps> = ({ data }) => {
    const width = 500;
    const height = 250;

    return (
        <GlassCard className="p-6 h-full flex flex-col">
            <h2 className="text-xl font-bold text-white mb-4">Tap Locations</h2>
            <div className="bg-black/20 rounded-lg p-2 flex items-center justify-center flex-grow">
                {/* Simplified World Map SVG Placeholder */}
                <svg viewBox={`0 0 ${width} ${height}`} className="w-full h-auto">
                    <rect width={width} height={height} fill="#1a1a1a" />
                    {/* A very rough world map shape */}
                    <path fill="#444" d="M499.999 135.539C499.231 135.539 498.471 135.539 497.702 135.539C481.531 135.539 465.36 135.539 449.19 135.539C448.91 135.539 448.63 135.539 448.35 135.539C448.07 136.219 447.79 136.899 447.51 137.579C444.71 144.379 441.91 151.179 439.11 157.979C438.83 158.659 438.55 159.339 438.27 160.019C436.03 160.019 433.79 160.019 431.55 160.019C425.95 151.699 420.35 143.379 414.75 135.059C414.47 134.379 414.19 133.699 413.91 133.019C411.67 133.019 409.43 133.019 407.19 133.019C407.19 129.859 407.19 126.699 407.19 123.539C407.95 122.179 408.71 120.819 409.47 119.459C411.71 114.659 413.95 109.859 416.19 105.059C417.63 102.179 419.07 99.299 420.51 96.419C422.39 92.579 424.27 88.739 426.15 84.899C427.75 81.699 429.35 78.499 430.95 75.299C431.23 74.619 431.51 73.939 431.79 73.259C433.95 73.259 436.11 73.259 438.27 73.259C438.27 70.099 438.27 66.939 438.27 63.779C436.11 63.779 433.95 63.779 431.79 63.779C431.79 61.379 431.79 58.979 431.79 56.579C429.63 56.579 427.47 56.579 425.31 56.579C416.91 62.499 408.51 68.419 400.11 74.339C398.43 75.699 396.75 77.059 395.07 78.419C393.83 74.979 392.59 71.539 391.35 68.099C389.91 64.139 388.47 60.179 387.03 56.219C386.67 55.139 386.31 54.059 385.95 52.979C384.07 52.979 382.19 52.979 380.31 52.979C377.51 58.899 374.71 64.819 371.91 70.739C371.23 72.259 370.55 73.779 369.87 75.299C365.15 75.299 360.43 75.299 355.71 75.299C354.35 72.499 352.99 69.699 351.63 66.899C349.55 62.499 347.47 58.099 345.39 53.699C344.71 52.259 344.03 50.819 343.35 49.379C341.11 49.379 338.87 49.379 336.63 49.379C334.39 54.179 332.15 58.979 329.91 63.779C327.67 68.579 325.43 73.379 323.19 78.179C322.91 78.859 322.63 79.539 322.35 80.219C320.19 80.219 318.03 80.219 315.87 80.219C315.87 82.259 315.87 84.299 315.87 86.339C314.19 86.339 312.51 86.339 310.83 86.339C304.91 93.859 298.99 101.379 293.07 108.899C291.55 110.819 290.03 112.739 288.51 114.659C287.07 116.499 285.63 118.339 284.19 120.179C281.23 120.179 278.27 120.179 275.31 120.179C274.63 118.019 273.95 115.859 273.27 113.699C271.19 107.219 269.11 100.739 267.03 94.259C266.35 92.179 265.67 90.099 264.99 88.019C262.03 88.019 259.07 88.019 256.11 88.019C254.91 91.219 253.71 94.419 252.51 97.619C250.75 102.499 248.99 107.379 247.23 112.259C246.47 114.299 245.71 116.339 244.95 118.379C242.71 118.379 240.47 118.379 238.23 118.379C236.35 121.579 234.47 124.779 232.59 127.979C229.47 133.259 226.35 138.539 223.23 143.819C222.15 145.659 221.07 147.499 219.99 149.339C216.79 149.339 213.59 149.339 210.39 149.339C208.51 146.139 206.63 142.939 204.75 139.739C202.19 135.259 199.63 130.779 197.07 126.299C196.39 125.219 195.71 124.139 195.03 123.059C192.51 123.059 189.99 123.059 187.47 123.059C187.47 124.819 187.47 126.579 187.47 128.339C185.31 128.339 183.15 128.339 180.99 128.339C180.31 126.579 179.63 124.819 178.95 123.059C177.59 119.539 176.23 116.019 174.87 112.499C172.91 107.459 170.95 102.419 168.99 97.379C168.39 95.899 167.79 94.419 167.19 92.939C164.95 92.939 162.71 92.939 160.47 92.939C160.47 95.339 160.47 97.739 160.47 100.139C157.95 100.139 155.43 100.139 152.91 100.139C146.99 105.739 141.07 111.339 135.15 116.939C134.47 117.619 133.79 118.299 133.11 118.979C130.15 118.979 127.19 118.979 124.23 118.979C124.23 120.339 124.23 121.699 124.23 123.059C121.27 123.059 118.31 123.059 115.35 123.059C114.67 121.699 113.99 120.339 113.31 118.979C111.15 114.819 108.99 110.659 106.83 106.499C105.87 104.659 104.91 102.819 103.95 100.979C101.43 100.979 98.91 100.979 96.39 100.979C93.67 105.419 90.95 109.859 88.23 114.299C86.95 116.459 85.67 118.619 84.39 120.779C81.87 120.779 79.35 120.779 76.83 120.779C76.83 122.539 76.83 124.299 76.83 126.059C73.95 126.059 71.07 126.059 68.19 126.059C66.83 128.859 65.47 131.659 64.11 134.459C62.15 138.499 60.19 142.539 58.23 146.579C57.63 147.859 57.03 149.139 56.43 150.419C53.83 150.419 51.23 150.419 48.63 150.419C48.63 152.179 48.63 153.939 48.63 155.699C46.03 155.699 43.43 155.699 40.83 155.699C38.95 152.499 37.07 149.299 35.19 146.099C31.43 139.619 27.67 133.139 23.91 126.659C23.23 125.579 22.55 124.499 21.87 123.419C19.99 123.419 18.11 123.419 16.23 123.419C15.55 124.859 14.87 126.299 14.19 127.739C12.11 131.979 10.03 136.219 7.95 140.459C5.15 146.219 2.35 151.979 -0.45 157.739C2.07 157.739 4.59 157.739 7.11 157.739C10.71 150.699 14.31 143.659 17.91 136.619C18.27 135.899 18.63 135.179 18.99 134.459C21.15 134.459 23.31 134.459 25.47 134.459C26.15 135.899 26.83 137.339 27.51 138.779C30.31 144.699 33.11 150.619 35.91 156.539C36.59 157.979 37.27 159.419 37.95 160.859C40.11 160.859 42.27 160.859 44.43 160.859C44.43 163.259 44.43 165.659 44.43 168.059C46.59 168.059 48.75 168.059 50.91 168.059C54.11 162.459 57.31 156.859 60.51 151.259C61.19 150.059 61.87 148.859 62.55 147.659C64.71 147.659 66.87 147.659 69.03 147.659C69.03 145.259 69.03 142.859 69.03 140.459C71.19 140.459 73.35 140.459 75.51 140.459C76.19 141.899 76.87 143.339 77.55 144.779C80.35 150.699 83.15 156.619 85.95 162.539C86.63 163.979 87.31 165.419 87.99 166.859C90.15 166.859 92.31 166.859 94.47 166.859C96.35 163.659 98.23 160.459 100.11 157.259C101.99 154.059 103.87 150.859 105.75 147.659C108.27 147.659 110.79 147.659 113.31 147.659C113.31 145.259 113.31 142.859 113.31 140.459C115.47 140.459 117.63 140.459 119.79 140.459C123.39 145.659 126.99 150.859 130.59 156.059C131.27 157.139 131.95 158.219 132.63 159.299C134.79 159.299 136.95 159.299 139.11 159.299C143.43 151.779 147.75 144.259 152.07 136.739C152.75 135.539 153.43 134.339 154.11 133.139C156.27 133.139 158.43 133.139 160.59 133.139C160.59 130.739 160.59 128.339 160.59 125.939C162.75 125.939 164.91 125.939 167.07 125.939C169.23 130.099 171.39 134.259 173.55 138.419C174.63 140.499 175.71 142.579 176.79 144.659C178.95 144.659 181.11 144.659 183.27 144.659C183.95 143.219 184.63 141.779 185.31 140.339C187.83 135.419 190.35 130.499 192.87 125.579C193.55 124.139 194.23 122.699 194.91 121.259C197.07 121.259 199.23 121.259 201.39 121.259C201.39 119.499 201.39 117.739 201.39 115.979C203.55 115.979 205.71 115.979 207.87 115.979C210.03 119.819 212.19 123.659 214.35 127.499C215.43 129.419 216.51 131.339 217.59 133.259C219.75 133.259 221.91 133.259 224.07 133.259C224.07 130.859 224.07 128.459 224.07 126.059C226.23 126.059 228.39 126.059 230.55 126.059C233.75 120.459 236.95 114.859 240.15 109.259C240.83 108.059 241.51 106.859 242.19 105.659C244.35 105.659 246.51 105.659 248.67 105.659C249.35 107.099 250.03 108.539 250.71 109.979C253.51 115.899 256.31 121.819 259.11 127.739C259.79 129.179 260.47 130.619 261.15 132.059C263.31 132.059 265.47 132.059 267.63 132.059C270.43 126.139 273.23 120.219 276.03 114.299C277.47 111.339 278.91 108.379 280.35 105.419C282.51 105.419 284.67 105.419 286.83 105.419C289.79 110.699 292.75 115.979 295.71 121.259C296.39 122.539 297.07 123.819 297.75 125.099C299.91 125.099 302.07 125.099 304.23 125.099C304.91 126.539 305.59 127.979 306.27 129.419C311.55 140.219 316.83 151.019 322.11 161.819C324.27 161.819 326.43 161.819 328.59 161.819C334.51 152.099 340.43 142.379 346.35 132.659C347.03 131.459 347.71 130.259 348.39 129.059C350.55 129.059 352.71 129.059 354.87 129.059C354.87 126.659 354.87 124.259 354.87 121.859C357.03 121.859 359.19 121.859 361.35 121.859C364.55 127.459 367.75 133.059 370.95 138.659C371.63 139.859 372.31 141.059 372.99 142.259C375.15 142.259 377.31 142.259 379.47 142.259C381.35 139.059 383.23 135.859 385.11 132.659C387.75 128.179 390.39 123.699 393.03 119.219C393.71 117.939 394.39 116.659 395.07 115.379C397.23 115.379 399.39 115.379 401.55 115.379C401.55 113.619 401.55 111.859 401.55 110.099C403.71 110.099 405.87 110.099 408.03 110.099C408.03 107.699 408.03 105.299 408.03 102.899C410.19 102.899 412.35 102.899 414.51 102.899C417.31 108.819 420.11 114.739 422.91 120.659C423.59 122.099 424.27 123.539 424.95 124.979C427.11 124.979 429.27 124.979 431.43 124.979C433.95 120.419 436.47 115.859 438.99 111.299C441.51 106.739 444.03 102.179 446.55 97.619C447.23 96.339 447.91 95.059 448.59 93.779C450.75 93.779 452.91 93.779 455.07 93.779C455.07 90.579 455.07 87.379 455.07 84.179C457.23 84.179 459.39 84.179 461.55 84.179C463.43 87.379 465.31 90.579 467.19 93.779C471.63 101.219 476.07 108.659 480.51 116.099C481.59 117.859 482.67 119.619 483.75 121.379C485.91 121.379 488.07 121.379 490.23 121.379C490.23 124.539 490.23 127.699 490.23 130.859C493.19 130.859 496.15 130.859 499.11 130.859C499.39 132.419 499.67 133.979 499.95 135.539H500L499.999 135.539z" />

                    {data.map(({ lat, lng, count }, index) => {
                        const { x, y } = project(lat, lng, width, height);
                        const radius = 2 + Math.log(count) * 2;
                        return (
                            <circle
                                key={index}
                                cx={x}
                                cy={y}
                                r={radius}
                                fill="rgba(22, 163, 74, 0.7)"
                                stroke="#16A34A"
                                strokeWidth="1"
                                className="animate-pulse"
                            >
                                <title>{`Count: ${count}`}</title>
                            </circle>
                        );
                    })}
                </svg>
            </div>
        </GlassCard>
    );
};

export default TapHeatmap;
